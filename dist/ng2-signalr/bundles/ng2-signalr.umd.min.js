!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("@angular/core"),require("signalr-no-jquery")):"function"==typeof define&&define.amd?define("ng2-signalr",["exports","rxjs","@angular/core","signalr-no-jquery"],e):e((n=n||self)["ng2-signalr"]={},n.rxjs,n.ng.core,n.signalrNoJquery)}(this,function(n,e,t,r){"use strict";var o=function(n,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])})(n,e)};function i(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var r,o,i=t.call(n),s=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(u){o={error:u}}finally{try{r&&!r.done&&(t=i["return"])&&t.call(i)}finally{if(o)throw o.error}}return s}function s(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(i(arguments[e]));return n}var u=function(n){function e(e){var t=n.call(this)||this;if(t.event=e,null==e||""===e)throw new Error("Failed to create BroadcastEventListener. Argument 'event' can not be empty");return t}return function(n,e){function t(){this.constructor=n}o(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}(e,n),e}(e.Subject),c=function(){function n(n,e,t){this._mockErrors$=n,this._mockStatus$=e,this._listeners=t}return Object.defineProperty(n.prototype,"errors",{get:function(){return this._mockErrors$},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._mockStatus$.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){return"xxxxxxxx-xxxx-xxxx-xxxxxxxxx"},enumerable:!0,configurable:!0}),n.prototype.stop=function(){},n.prototype.start=function(){return Promise.resolve(null)},n.prototype.invoke=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return Promise.resolve(null)},n.prototype.listen=function(n){this._listeners[n.event]=n},n.prototype.listenFor=function(n){var e=new u(n);return this.listen(e),e},n.prototype.listenForRaw=function(n){var e=new u(n);return this._listeners[e.event]=e,e},n}(),a=function(){function n(){this._errors$=new e.Subject,this._status$=new e.Subject,this._listeners={},this._object=new c(this._errors$,this._status$,this._listeners)}return Object.defineProperty(n.prototype,"mock",{get:function(){return this._object},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"errors$",{get:function(){return this._errors$},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"status$",{get:function(){return this._status$},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"listeners",{get:function(){return this._listeners},enumerable:!0,configurable:!0}),n}(),l=function(){function n(n){if(null==n||n<0)throw new Error("Failed to create ConnectionStatus. Argument 'name' can not be null or empty.");this._value=n}return Object.defineProperty(n.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return n.names[Number(this._value.toString())]},enumerable:!0,configurable:!0}),n.prototype.toString=function(){return this.name},n.prototype.equals=function(n){return null!=n&&this._value===n.value},n.names=["connecting","connected","reconnecting","","disconnected"],n}(),f=function(){function n(){}return Object.defineProperty(n,"connecting",{get:function(){return n.statuses[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n,"connected",{get:function(){return n.statuses[1]},enumerable:!0,configurable:!0}),Object.defineProperty(n,"reconnecting",{get:function(){return n.statuses[2]},enumerable:!0,configurable:!0}),Object.defineProperty(n,"disconnected",{get:function(){return n.statuses[3]},enumerable:!0,configurable:!0}),n.statuses=[new l(0),new l(1),new l(2),new l(4)],n}(),g=function(){function n(n,e,t,r){this._jProxy=e,this._jConnection=n,this._zone=t,this._errors=this.wireUpErrorsAsObservable(),this._status=this.wireUpStatusEventsAsObservable(),this._configuration=r,this._listeners={}}return Object.defineProperty(n.prototype,"errors",{get:function(){return this._errors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),n.prototype.start=function(){var n=this,e=this.convertTransports(this._configuration.transport);return new Promise(function(t,r){n._jConnection.start({jsonp:n._configuration.jsonp,pingInterval:n._configuration.pingInterval,transport:e,withCredentials:n._configuration.withCredentials}).done(function(){console.log("Connection established, ID: "+n._jConnection.id),console.log("Connection established, Transport: "+n._jConnection.transport.name),t(n)}).fail(function(n){console.log("Could not connect"),r("Failed to connect. Error: "+n.message)})})},n.prototype.stop=function(){this._jConnection.stop()},Object.defineProperty(n.prototype,"id",{get:function(){return this._jConnection.id},enumerable:!0,configurable:!0}),n.prototype.invoke=function(n){for(var e=this,t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(null==n)throw new Error("SignalRConnection: Failed to invoke. Argument 'method' can not be null");this.log("SignalRConnection. Start invoking '"+n+"'...");var o=new Promise(function(r,o){var i;(i=e._jProxy).invoke.apply(i,s([n],t)).done(function(t){e.log("'"+n+"' invoked succesfully. Resolving promise..."),r(t),e.log("Promise resolved.")}).fail(function(e){console.log("Invoking '"+n+"' failed. Rejecting promise..."),o(e),console.log("Promise rejected.")})});return o},n.prototype.listen=function(n){var e=this;if(null==n)throw new Error("Failed to listen. Argument 'listener' can not be null");this.setListener(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.run(function(){var r=null;t.length>0&&(r=t[0]),e.log("SignalRConnection.proxy.on invoked. Calling listener next() ..."),n.next(r),e.log("listener next() called.")},e._configuration.executeEventsInZone)},n)},n.prototype.stopListening=function(n){var e,t;if(null==n)throw new Error("Failed to listen. Argument 'listener' can not be null");this.log("SignalRConnection: Stopping listening to server event with name "+n.event),this._listeners[n.event]||(this._listeners[n.event]=[]);try{for(var r=function(n){var e="function"==typeof Symbol&&n[Symbol.iterator],t=0;return e?e.call(n):{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}}}(this._listeners[n.event]),o=r.next();!o.done;o=r.next()){var i=o.value;this._jProxy.off(n.event,i)}}catch(s){e={error:s}}finally{try{o&&!o.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}this._listeners[n.event]=[]},n.prototype.listenFor=function(n){if(null==n||""===n)throw new Error("Failed to listen. Argument 'event' can not be empty");var e=new u(n);return this.listen(e),e},n.prototype.listenForRaw=function(n){var e=this;if(null==n||""===n)throw new Error("Failed to listen. Argument 'event' can not be empty");var t=new u(n);return this.setListener(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];e.run(function(){e.log("SignalRConnection.proxy.on invoked. Calling listener next() ..."),t.next(n),e.log("listener next() called.")},e._configuration.executeEventsInZone)},t),t},n.prototype.setListener=function(n,e){this.log("SignalRConnection: Starting to listen to server event with name "+e.event),this._jProxy.on(e.event,n),null==this._listeners[e.event]&&(this._listeners[e.event]=[]),this._listeners[e.event].push(n)},n.prototype.convertTransports=function(n){return n instanceof Array?n.map(function(n){return n.name}):n.name},n.prototype.wireUpErrorsAsObservable=function(){var n=this,t=new e.Subject;return this._jConnection.error(function(e){n.run(function(){return t.next(e)},n._configuration.executeErrorsInZone)}),t},n.prototype.wireUpStatusEventsAsObservable=function(){var n=this,t=new e.Subject;return this._jConnection.stateChanged(function(e){n.run(function(){return t.next(new l(e.newState))},n._configuration.executeStatusChangeInZone)}),t.asObservable()},n.prototype.onBroadcastEventReceived=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];this.log("SignalRConnection.proxy.on invoked. Calling listener next() ...");var r=null;e.length>0&&(r=e[0]),this.run(function(){n.next(r)},this._configuration.executeEventsInZone),this.log("listener next() called.")},n.prototype.log=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];!1!==this._jConnection.logging&&console.log(n.join(", "))},n.prototype.run=function(n,e){e?this._zone.run(function(){return n()}):this._zone.runOutsideAngular(function(){return n()})},n}(),p=function(){function n(n){if(null==n||""===n)throw new Error("Failed to create ConnectionTransport. Argument 'name' can not be null or empty.");this._name=n}return Object.defineProperty(n.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),n.prototype.toString=function(){return this._name},n.prototype.equals=function(n){return null!=n&&this._name===n.name},n}(),h=function(){function n(){}return Object.defineProperty(n,"foreverFrame",{get:function(){return n.transports[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n,"longPolling",{get:function(){return n.transports[1]},enumerable:!0,configurable:!0}),Object.defineProperty(n,"serverSentEvents",{get:function(){return n.transports[2]},enumerable:!0,configurable:!0}),Object.defineProperty(n,"webSockets",{get:function(){return n.transports[3]},enumerable:!0,configurable:!0}),Object.defineProperty(n,"auto",{get:function(){return n.transports[4]},enumerable:!0,configurable:!0}),n.transports=[new p("foreverFrame"),new p("longPolling"),new p("serverSentEvents"),new p("webSockets"),new p("auto")],n}(),v=function(){this.hubName=null,this.logging=!1,this.qs=null,this.url=null,this.jsonp=!1,this.withCredentials=!1,this.transport=h.auto,this.executeEventsInZone=!0,this.executeErrorsInZone=!1,this.executeStatusChangeInZone=!0,this.pingInterval=3e5},b=new t.InjectionToken("SIGNALR_JCONNECTION_TOKEN"),y=function(){function n(n,e,t){this._configuration=n,this._zone=e,this._jHubConnectionFn=t}return n.prototype.createConnection=function(n){var e=this.merge(n||{});this.logConfiguration(e);var t=this._jHubConnectionFn(e.url);t.logging=e.logging,t.qs=e.qs;var r=t.createHubProxy(e.hubName);return r.on("noOp",function(){}),new g(t,r,this._zone,e)},n.prototype.connect=function(n){return this.createConnection(n).start()},n.prototype.logConfiguration=function(n){try{var e=JSON.stringify(n.qs),t=JSON.stringify(n.transport);n.logging&&(console.log("Creating connecting with..."),console.log("configuration:[url: '"+n.url+"'] ..."),console.log("configuration:[hubName: '"+n.hubName+"'] ..."),console.log("configuration:[qs: '"+e+"'] ..."),console.log("configuration:[transport: '"+t+"'] ..."))}catch(r){}},n.prototype.merge=function(n){var e=new v;return e.hubName=n.hubName||this._configuration.hubName,e.url=n.url||this._configuration.url,e.qs=n.qs||this._configuration.qs,e.logging=this._configuration.logging,e.jsonp=n.jsonp||this._configuration.jsonp,e.withCredentials=n.withCredentials||this._configuration.withCredentials,e.transport=n.transport||this._configuration.transport,e.executeEventsInZone=n.executeEventsInZone||this._configuration.executeEventsInZone,e.executeErrorsInZone=n.executeErrorsInZone||this._configuration.executeErrorsInZone,e.executeStatusChangeInZone=n.executeStatusChangeInZone||this._configuration.executeStatusChangeInZone,e.pingInterval=n.pingInterval||this._configuration.pingInterval,e},n.decorators=[{type:t.Injectable}],n.ctorParameters=function(){return[{type:v},{type:t.NgZone},{type:undefined,decorators:[{type:t.Inject,args:[b]}]}]},n}(),d=new t.InjectionToken("SIGNALR_CONFIGURATION");function _(n,e){var t=function(){var n=r.hubConnection;if(null==n)throw new Error("Signalr failed to initialize. Script 'jquery.signalR.js' is missing. Please make sure to include 'jquery.signalR.js' script.");return n}();return new y(n,e,t)}var m=y,x=function(){function n(){}return n.forRoot=function(e){return{ngModule:n,providers:[{provide:d,useFactory:e},{deps:[d,t.NgZone],provide:y,useFactory:_}]}},n.forChild=function(){throw new Error("forChild method not implemented")},n.decorators=[{type:t.NgModule,args:[{providers:[{provide:y,useValue:m}]}]}],n}();n.BroadcastEventListener=u,n.ConnectionStatus=l,n.ConnectionStatuses=f,n.ConnectionTransport=p,n.ConnectionTransports=h,n.SignalR=y,n.SignalRConfiguration=v,n.SignalRConnection=g,n.SignalRConnectionMock=c,n.SignalRConnectionMockManager=a,n.SignalRModule=x,n.ɵa=_,n.ɵb=b,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=ng2-signalr.umd.min.js.map